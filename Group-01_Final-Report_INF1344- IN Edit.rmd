---
title: "Final Report"
subtitle: "HDI and Broadband - Data Analysis"
author: 'Group 01: Amie Leung, Ivan Nguyen, Janna Cameron, Kaye Ann Caroningan, and Syed Hassan'
output:
  html_document:
    toc: true
    toc_depth: '3'
---
<hr>
## Setup and Packages
```{r setup, echo=TRUE, results='hide', message=FALSE, warning=FALSE}
knitr::opts_chunk$set(tidy=TRUE, tidy.opts=list(width.cutoff=20))
library(tidyverse)
library(janitor)
library(skimr)
library(broom)
library(car)
library(lmtest)
```

## Loading the files
``` {r message=FALSE, warning=FALSE, results='hide'}
setwd("/Users/ivan/Desktop/Master of Information/")
hdi <- read.csv("hdi_human_development_index.csv")
broadband <- read.csv("broadband_subscribers_per_100_people.csv")
gdp <- read.csv("gdp_pcap.csv")

glimpse(hdi)
glimpse(broadband)
glimpse(gdp)
```

## Processing Dataframes
### Cleaning header names
``` {r message=FALSE, warning=FALSE}
hdi_clean <- clean_names(hdi)
names(hdi_clean) <- gsub("^x", "", names(hdi_clean))
head(hdi_clean, 1)

#changing the columns in broadband to dbl and treat missing values as NA
broadband <- broadband %>%
  mutate(across(c("X2003","X2004","X2005","X2006","X2010","X2011"),
                as.numeric))

broadband_clean <- clean_names(broadband)
names(broadband_clean) <- gsub("^x", "", names(broadband_clean))
head(broadband_clean, 1)

gdp_clean <- clean_names(gdp)
names(gdp_clean) <- gsub("^X","", names(gdp))
head(gdp_clean,1)
```

### Checking and removing duplicates
``` {r message=FALSE, warning=FALSE}
remove_duplicates <- function(data) {
  original_rows <- nrow(data)
  
  data_noDuplicates <- data %>%
    distinct()
  
  new_rows <- nrow(data_noDuplicates)
  
  rows_removed <- original_rows - new_rows
  print_statement <- paste(rows_removed, "rows removed.")
  cat(print_statement)
  
  return(data_noDuplicates)
}

hdi_clean <- remove_duplicates(hdi_clean)
broadband_clean <- remove_duplicates(broadband_clean)
gdp_clean <- remove_duplicates(gdp_clean)
```

### Handling missing values
``` {r message=FALSE, warning=FALSE}
skim(hdi_clean)
skim(broadband_clean)
skim(gdp_clean)
```

cat("HDI: Number of empty records removed:", sum(is.na(hdi_clean)))
hdi_clean <- hdi_clean %>% drop_na() 
cat("Broadband: Number of empty records removed:", sum(is.na(broadband_clean)))
broadband_clean <- broadband_clean %>% drop_na() 
cat("GDP: Number of empty records removed:", sum(is.na(gdp_clean)))
gdp_clean <- gdp_clean %>% drop_na()


``` {r message=FALSE, warning=FALSE}
#create a long table for easy analysis
broadband_long <- broadband_clean %>%
  pivot_longer(cols=-country, names_to="year", values_to="broadband") %>%
  mutate(year=as.numeric(year))
hdi_long <- hdi_clean %>%
  pivot_longer(cols=-country, names_to="year", values_to="hdi") %>%
  mutate(year=as.numeric(year))
gdp_long <- gdp_clean[-1.] %>%
  rename(country=name) %>%
  pivot_longer(cols=-country, names_to="year", values_to="gdp") %>%
  mutate(year=as.numeric(year))
```

``` {r message=FALSE, warning=FALSE}
#Join the HDI & Broadband data by year and country
merged_data <- merge(broadband_long, hdi_long, by = c("country","year"))

#Join the GDP dataset
merged_data <- merge(merged_data, gdp_long, by = c("country", "year"))

#remove the missing values
merged_data <- na.omit(merged_data)
```

## Data Visualization

``` {r message=FALSE, warning=FALSE}
#visualize the relationship between broadband subscription and HDI over the time
ggplot(merged_data, aes(x = broadband, y = hdi)) +
  geom_point(alpha = 0.6, color = "steelblue") +
  geom_smooth(method = "lm", color = "darkred") +
  theme_minimal() +
  labs(title = "Relationship between Broadband Subscriptions and HDI",
       x = "Broadband subscriptions per 100 people",
       y = "Human Development Index")
```

#Looking at the first research question 
#What is the relationship between HDI and broadband subscriptions, based on the latest available data, which is 2023.

``` {r message=FALSE, warning=FALSE}
#Pull the data for 2023 only
data_2023 <- merged_data %>% filter(year==2023)

#visualize the relationship between broadband subscription and HDI in the year of 2023
ggplot(data_2023, aes(x = broadband, y = hdi)) +
  geom_point(alpha = 0.6, color = "steelblue") +
  geom_smooth(method = "lm", color = "darkred") +
  theme_minimal() +
  labs(title = "Relationship between Broadband Subscriptions and HDI in the year 2023",
       x = "Broadband subscriptions per 100 people",
       y = "Human Development Index")
```

``` {r message=FALSE, warning=FALSE}
#Test the skewness and distribution of the data
#Histogram of HDI in 2023. Histogram show that the HDI of 2023 is mildy left skewed
ggplot(data_2023,aes(x=hdi))+
  geom_histogram(colour="white", fill="steelblue")+
  labs(title="Histogram of HDI in 2023",
       x = "HDI",
       y = "Frequency")
```

``` {r message=FALSE, warning=FALSE}
# Box plot of HDI in 2023
ggplot(data_2023, aes(y=hdi)) + 
  geom_boxplot() + 
  labs(title = "Box plot of HDI in 2023",
       y="Count")
```

``` {r message=FALSE, warning=FALSE}
#Histogram of broadband in 2023. Histogram show that the broadband data is right skewed
ggplot(data_2023,aes(x=broadband))+
  geom_histogram(colour="white", fill="steelblue")+
  labs(title="Histogram of Broadband in 2023",
       x = "Broadband",
       y = "Frequency")
```

``` {r message=FALSE, warning=FALSE}
# Box plot of broadband in 2023
ggplot(data_2023, aes(y=broadband)) + 
  geom_boxplot() + 
  labs(title = "Box plot of Broadband in 2023",
       y="Count")
```
Need to transform the broadband dataset. Option 1: Log Transform
``` {r message=FALSE, warning=FALSE}
#log transformed the broadband
data_2023 <- data_2023 %>%
  mutate(broadband = ifelse(broadband == 0, NA, broadband)) %>%
  mutate(log_broadband = log(broadband))

#Testing the skewness of log transform broadband values
ggplot(data_2023,aes(x=log_broadband))+
  geom_histogram(colour="white", fill="steelblue")+
  labs(title="Histogram of Log Tranformed Broadband in 2023",
       x = "Log Transformed Broadband",
       y = "Frequency")

shapiro.test(data_2023$log_broadband)

qqnorm(data_2023$log_broadband, main = "Q-Q Plot for log transformed broadband", xlab = "Theoretical Quantiles", ylab = "log transformed broadband")

# Add a reference line
qqline(data_2023$log_broadband, col = "steelblue", lwd = 2)
```
Option 2: Square root Transform
``` {r message=FALSE, warning=FALSE}
#Square root transform of the broadband dataset. 
data_2023 <- data_2023 %>%
  mutate(sqrt_broadband = sqrt(broadband))

#Testing the skewness of log transform broadband values
ggplot(data_2023,aes(x=sqrt_broadband))+
  geom_histogram(colour="white", fill="steelblue")+
  labs(title="Histogram of Square rootTranformed Broadband in 2023",
       x = "Square root Transformed Broadband",
       y = "Frequency")

shapiro.test(data_2023$sqrt_broadband)

qqnorm(data_2023$sqrt_broadband, main = "Q-Q Plot for Square root transformed broadband", xlab = "Theoretical Quantiles", ylab = "log transformed broadband")

# Add a reference line
qqline(data_2023$sqrt_broadband, col = "steelblue", lwd = 2)
```

``` {r message=FALSE, warning=FALSE}
#Create a scatter plot of square root broadband vs hdi of 2023
ggplot(data_2023, aes(x = sqrt_broadband, y = hdi)) +
  geom_point(color = "steelblue") +                                               # Add scatter points
  geom_smooth(method = "lm", color = "darkred", linetype = "solid") + # Adds a linear regression line
  labs(title = "Scatter Plot with Line of Best Fit of Square root Broadband vs HDI",
       x = "Square root Broadband Subscription per 100",
       y = "HDI")
```

``` {r message=FALSE, warning=FALSE}
#Create a model for 2023 data
model_2023 <- lm(hdi ~ sqrt_broadband, data=data_2023)
summary(model_2023)
```

#We want to do a comparision between 2011 and 2023.
#In 2011, the United Nations General Assembly highlighed Internet access as a basic human right
```{r}
data_2011 <- merged_data %>% filter(year==2011)

#visualize the relationship between broadband subscription and HDI in the year of 2011
ggplot(data_2011, aes(x = broadband, y = hdi)) +
  geom_point(alpha = 0.6, color = "steelblue") +
  geom_smooth(method = "lm", color = "darkred") +
  theme_minimal() +
  labs(title = "Relationship between Broadband Subscriptions and HDI in the year 2011",
       x = "Broadband subscriptions per 100 people",
       y = "Human Development Index")
```

``` {r message=FALSE, warning=FALSE}
#Test the skewness and distribution of the data
#Histogram of HDI in 2011. Histogram show that the HDI of 2011 is mildy left skewed
ggplot(data_2011,aes(x=hdi))+
  geom_histogram(colour="white", fill="steelblue")+
  labs(title="Histogram of HDI in 2011",
       x = "HDI",
       y = "Frequency")
```

``` {r message=FALSE, warning=FALSE}
# Box plot of HDI in 2011
ggplot(data_2011, aes(y=hdi)) + 
  geom_boxplot() + 
  labs(title = "Box plot of HDI in 2011",
       y="Count")
```

``` {r message=FALSE, warning=FALSE}
#Histogram of broadband in 2011. Histogram show that the broadband data is severe right skewed
ggplot(data_2011,aes(x=broadband))+
  geom_histogram(colour="white", fill="steelblue")+
  labs(title="Histogram of Broadband in 2011",
       x = "Broadband",
       y = "Frequency")
```

``` {r message=FALSE, warning=FALSE}
# Box plot of broadband in 2023
ggplot(data_2011, aes(y=broadband)) + 
  geom_boxplot() + 
  labs(title = "Box plot of Broadband in 2011",
       y="Count")
```
Need to transform the braodband dataset. Option 1: Log Transform
``` {r message=FALSE, warning=FALSE}
data_2011 <- data_2011 %>%
  filter(broadband != 0) %>%
  mutate(log_broadband = log(broadband))

#Testing the skewness of log transform broadband values
ggplot(data_2011,aes(x=log_broadband))+
  geom_histogram(colour="white", fill="steelblue")+
  labs(title="Histogram of Log Tranformed Broadband in 2011",
       x = "Log Transformed Broadband",
       y = "Frequency")

shapiro.test(data_2011$log_broadband)

qqnorm(data_2011$log_broadband, main = "Q-Q Plot for log transformed broadband", xlab = "Theoretical Quantiles", ylab = "log transformed broadband")

# Add a reference line
qqline(data_2011$log_broadband, col = "steelblue", lwd = 2)
```
Option 2: Square root Transform
``` {r message=FALSE, warning=FALSE}
#Square root transform the broadband dataset. 
data_2011 <- data_2011 %>%
  mutate(sqrt_broadband = sqrt(broadband))

#Testing the skewness of log transform broadband values
ggplot(data_2011,aes(x=sqrt_broadband))+
  geom_histogram(colour="white", fill="steelblue")+
  labs(title="Histogram of Square root Tranformed Broadband in 2011",
       x = "Square root Transformed Broadband",
       y = "Frequency")

shapiro.test(data_2011$sqrt_broadband)

qqnorm(data_2011$sqrt_broadband, main = "Q-Q Plot for Square root transformed broadband", xlab = "Theoretical Quantiles", ylab = "log transformed broadband")

# Add a reference line
qqline(data_2011$sqrt_broadband, col = "steelblue", lwd = 2)
```

``` {r message=FALSE, warning=FALSE}
#Create a scatter plot of square root broadband vs hdi of 2011
ggplot(data_2011, aes(x = sqrt_broadband, y = hdi)) +
  geom_point(color = "steelblue") +                                               # Add scatter points
  geom_smooth(method = "lm", color = "darkred", linetype = "solid") + # Adds a linear regression line
  labs(title = "Scatter Plot with Line of Best Fit of Square root Broadband vs HDI",
       x = "Square root Broadband Subscription per 100",
       y = "HDI")
```

``` {r message=FALSE, warning=FALSE}
#Create a model for 2011 data
model_2011 <- lm(hdi ~ sqrt_broadband, data=data_2011)
summary(model_2011)
```

#Question 2: Finding the outliers countries in 2023
```{r message=FALSE, warning=FALSE}
data_2023 <- na.omit(data_2023) %>%
  mutate(
    fitted_hdi = fitted(model_2023,),
    residuals = resid(model_2023),
    std_resid = rstandard(model_2023)
  )

outliers <- data_2023 %>%
  filter(abs(std_resid) > 3)

outliers
```

#Question 3: looking at GDP as the controlling factor
#Testing the skewness of GDP
```{r}
#histogram of GDP in 2023
ggplot(data_2023,aes(x=gdp))+
  geom_histogram(colour="white", fill="steelblue")+
  labs(title="Histogram of GDP in 2023",
       x = "GDP",
       y = "Frequency")

# Box plot of GDP in 2023
ggplot(data_2023, aes(y=gdp)) + 
  geom_boxplot() + 
  labs(title = "Box plot of GDP in 2023",
       y="Count")

```
The GDP dataset is right skewed and need to be transformed. Option 1: Log transform
```{r}
data_2023 <- data_2023 %>%
  filter(broadband != 0) %>%
  mutate(log_gdp = log(gdp))

#Testing the skewness of log transform broadband values
ggplot(data_2023,aes(x=log_gdp))+
  geom_histogram(colour="white", fill="steelblue")+
  labs(title="Histogram of Log Tranformed GDP in 2023",
       x = "Log Transformed GDP",
       y = "Frequency")

shapiro.test(data_2023$log_gdp)

qqnorm(data_2023$log_gdp, main = "Q-Q Plot for log transformed GDP", xlab = "Theoretical Quantiles", ylab = "log transformed GDP")

# Add a reference line
qqline(data_2023$log_gdp, col = "steelblue", lwd = 2)
```
Option 2: Square root transform gdp
```{r}
data_2023 <- data_2023 %>%
  filter(broadband != 0) %>%
  mutate(sqrt_gdp = sqrt(gdp))

#Testing the skewness of log transform broadband values
ggplot(data_2023,aes(x=sqrt_gdp))+
  geom_histogram(colour="white", fill="steelblue")+
  labs(title="Histogram of Square root Tranformed GDP in 2023",
       x = "Square root Transformed GDP",
       y = "Frequency")

shapiro.test(data_2023$sqrt_gdp)

qqnorm(data_2023$sqrt_gdp, main = "Q-Q Plot for Square root transformed GDP", xlab = "Theoretical Quantiles", ylab = "Square root transformed GDP")

# Add a reference line
qqline(data_2023$sqrt_gdp, col = "steelblue", lwd = 2)
```
#Create a scatter plot of log GDP vs hdi of 2023
```{r}
ggplot(data_2023, aes(x = log_gdp, y = hdi)) +
  geom_point(color = "steelblue") +                                               # Add scatter points
  geom_smooth(method = "lm", color = "darkred", linetype = "solid") + # Adds a linear regression line
  labs(title = "Scatter Plot with Line of Best Fit of Log GDP vs HDI",
       x = "Log GDP",
       y = "HDI")
```
#Create a multi regression with gdp as the control variable
```{r}
multi_reg <- lm (hdi ~ sqrt_broadband + log_gdp, data = data_2023)

summary(multi_reg)
```
#Checking assumptions
```{r}
plot(multi_reg, which = 1)

dwtest(multi_reg)

res_model <- residuals(multi_reg)
shapiro.test(res_model)
plot(multi_reg, which = 2)

pred_model <- fitted(multi_reg)
plot(pred_model, res_model,
     xlab = "Predicted Values (Fitted)",
     ylab = "Residuals",
     main = "Residuals vs Predicted Values",
     col = "steelblue")
abline(h = 0, col = "red", lwd = 2)

vif(multi_reg)
```
